<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>redis | 威猛盖哥</title><meta name="keywords" content="redis"><meta name="author" content="盖哥横扫千军"><meta name="copyright" content="盖哥横扫千军"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Nosql概述为什么要用Nosql 1、单机MYSQL的年代   数据量如果太大，一个机器放不下了 数据的索引（B + Tree）,一个机器内存也放不下 访问量（读写混合），一个服务器承受不了   出现以上三种情况之一，就必须要晋级  2、Memacshed(缓存) + MYSQL + 垂直拆分（读写分离）  希望减轻服务器的压力、使用缓存来保证效率 发展过程：优化数据结构和索引 —&gt; 文件">
<meta property="og:type" content="article">
<meta property="og:title" content="redis">
<meta property="og:url" content="https://dexin-wang-neu.github.io/2022/05/17/redis/index.html">
<meta property="og:site_name" content="威猛盖哥">
<meta property="og:description" content="Nosql概述为什么要用Nosql 1、单机MYSQL的年代   数据量如果太大，一个机器放不下了 数据的索引（B + Tree）,一个机器内存也放不下 访问量（读写混合），一个服务器承受不了   出现以上三种情况之一，就必须要晋级  2、Memacshed(缓存) + MYSQL + 垂直拆分（读写分离）  希望减轻服务器的压力、使用缓存来保证效率 发展过程：优化数据结构和索引 —&gt; 文件">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dexin-wang-neu.github.io/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png">
<meta property="article:published_time" content="2022-05-17T02:06:21.000Z">
<meta property="article:modified_time" content="2022-05-19T00:29:54.979Z">
<meta property="article:author" content="盖哥横扫千军">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dexin-wang-neu.github.io/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://dexin-wang-neu.github.io/2022/05/17/redis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'redis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-19 08:29:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"> <script src="/live2d-widget/autoload.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avator.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">威猛盖哥</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">redis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-17T02:06:21.000Z" title="发表于 2022-05-17 10:06:21">2022-05-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-19T00:29:54.979Z" title="更新于 2022-05-19 08:29:54">2022-05-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/redis/">redis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="redis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h4 id="Nosql概述"><a href="#Nosql概述" class="headerlink" title="Nosql概述"></a>Nosql概述</h4><h5 id="为什么要用Nosql"><a href="#为什么要用Nosql" class="headerlink" title="为什么要用Nosql"></a>为什么要用Nosql</h5><blockquote>
<p>1、单机MYSQL的年代</p>
</blockquote>
<ul>
<li>数据量如果太大，一个机器放不下了</li>
<li>数据的索引（B + Tree）,一个机器内存也放不下</li>
<li>访问量（读写混合），一个服务器承受不了</li>
</ul>
<p><img src="/2022/05/17/redis/image-20210602111138714.png" alt="image-20210602111138714"></p>
<p>出现以上三种情况之一，就必须要晋级</p>
<blockquote>
<p>2、Memacshed(缓存) + MYSQL + 垂直拆分（读写分离）</p>
</blockquote>
<p>希望减轻服务器的压力、使用缓存来保证效率</p>
<p>发展过程：优化数据结构和索引 —&gt; 文件缓存（IO） –&gt; Memcacahed(当时最热门的技术)</p>
<blockquote>
<p>3、分库分表+水平拆分+MYSQL集群</p>
</blockquote>
<blockquote>
<p>4、如今时代</p>
</blockquote>
<ul>
<li>MYSQL等关系型数据库就不够用了！数据量很多 </li>
<li>MYSQL有的使用它来存储一些较大的文件，博客，图片！数据表很大，效率就低了！如果有一种数据库来专门处理这种数据，MySQL的压力就小了</li>
</ul>
<blockquote>
<p>5.目前的互联网项目</p>
</blockquote>
<p><img src="/2022/05/17/redis/image-20210602110847515.png" alt="image-20210602110847515"></p>
<blockquote>
<p>为什么用NoSQL</p>
</blockquote>
<p>用户的个人信息、社交网络、地理位置。用户自己产生的数据、用户日志等等爆发式增长。</p>
<p>这时候我们就需要使用NoSQL数据库，NoSQL可以很好的处理以上的情况。</p>
<h5 id="什么是NoSQL"><a href="#什么是NoSQL" class="headerlink" title="什么是NoSQL"></a>什么是NoSQL</h5><blockquote>
<p>NoSQL</p>
</blockquote>
<p>NoSQL &#x3D;  Not Only SQL(不仅仅是SQL)</p>
<p>关系型数据库：表格、行、列。</p>
<p>泛指非关系型数据库，随着web2.0互联网的诞生，传统的关系型数据库很难对付web2.0时代。尤其是超大规模的高并发社区。</p>
<p>很多的数据类型用户的个人信息，社交网络，地理位置。这些数据类型的存储不需要一个固定的格式！</p>
<p>不需要多余的操作就可以横向扩展的！Map&lt;String,Object&gt;使用键值对来控制！</p>
<blockquote>
<p>NoSQL特点</p>
</blockquote>
<ul>
<li>方便扩展（数据之间没有关系，很好扩展）</li>
<li>大数据量高性能（Redis一秒写8万次，读取11万一秒，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高）</li>
<li>数据类型是多样型的（不需要事先设计数据库。随去随用。如果数据库十分大的表，很多人就无法设计了）</li>
<li>传动的关系型数据库（RDBMS）和NoSQL</li>
</ul>
<blockquote>
<p>传统的RDBMS</p>
<ul>
<li>结构化祖师</li>
<li>SQL</li>
<li>数据和关系都存在单独的表中</li>
<li>数据操作语言，数据定义语言</li>
<li>严格的一致性</li>
<li>基础的事务</li>
</ul>
</blockquote>
<blockquote>
<p>NoSQL</p>
<ul>
<li>不仅仅是数据</li>
<li>没有固定的查询语言</li>
<li>键值对存储，列存储，文档存储，图形数据库（社交关系）</li>
<li>最终一致性</li>
<li>CAP定理和BASE(异地多活)</li>
<li>高新能、高可用、高可扩展性</li>
</ul>
</blockquote>
<h5 id="阿里巴巴演进分析"><a href="#阿里巴巴演进分析" class="headerlink" title="阿里巴巴演进分析"></a>阿里巴巴演进分析</h5><p><img src="/2022/05/17/redis/image-20210602120705404.png" alt="image-20210602120705404"></p>
<h5 id="NoSQL的四大分类"><a href="#NoSQL的四大分类" class="headerlink" title="NoSQL的四大分类"></a>NoSQL的四大分类</h5><p><strong>KV键值对</strong></p>
<ul>
<li>新浪：Redis</li>
<li>美团：Redis + Tair</li>
<li>阿里，百度：Redis + memcache</li>
</ul>
<p><strong>文档型数据库（bson格式）</strong></p>
<ul>
<li>MongoDB(一般必须要掌握)<ul>
<li>MongoDB是一个基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档</li>
<li>MongoDB是一个介于关系型数据库和非关系型数据库中间的产品！MongoDB是非关心性数据库中功能最丰富，最像关系型数据库的！</li>
</ul>
</li>
</ul>
<p><strong>列存储数据库</strong></p>
<ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<p><strong>图关系数据库</strong></p>
<ul>
<li>不是存图形的，放的是关系。如：朋友圈社交网络，广告推荐</li>
</ul>
<p><strong>对比</strong></p>
<p><img src="/2022/05/17/redis/image-20210602121947362.png" alt="image-20210602121947362"></p>
<h4 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h4><h5 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h5><blockquote>
<p>Redis是什么？</p>
</blockquote>
<p>Redis(Remote Dictionary Server),远程字典服务</p>
<blockquote>
<p>Redis能做什么？</p>
</blockquote>
<ul>
<li>内存存储、持久化，内存中是断电丢失、所以说持久化很重要（rdb,aof）</li>
<li>小路高，可以用于高速缓存</li>
<li>发布订阅系统</li>
<li>地图信息分析</li>
<li>计时器、计数器（浏览量）</li>
</ul>
<blockquote>
<p>特性</p>
</blockquote>
<ul>
<li>多样的数据类型</li>
<li>持久化</li>
<li>集群</li>
<li>事物</li>
</ul>
<blockquote>
<p>学习中需要用到的东西</p>
</blockquote>
<ul>
<li>官网：<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></li>
<li>中文网：<a target="_blank" rel="noopener" href="https://www.redis.cn/">https://www.redis.cn/</a></li>
<li>下载地址：</li>
</ul>
<h5 id="windows安装"><a href="#windows安装" class="headerlink" title="windows安装"></a>windows安装</h5><ul>
<li>1.下载安装包</li>
</ul>
<p><img src="/2022/05/17/redis/image-20210602144746430.png" alt="image-20210602144746430"></p>
<h5 id="linux安装"><a href="#linux安装" class="headerlink" title="linux安装"></a>linux安装</h5><p><img src="/2022/05/17/redis/image-20210603190644081.png" alt="image-20210603190644081"></p>
<p><img src="/2022/05/17/redis/image-20210603195130190.png" alt="image-20210603195130190"></p>
<p><img src="/2022/05/17/redis/image-20210603195512417.png" alt="image-20210603195512417"></p>
<p><img src="/2022/05/17/redis/image-20210603195553950.png" alt="image-20210603195553950"></p>
<p>5.redis的默认安装路径 <code>/usr</code>下面</p>
<p><img src="/2022/05/17/redis/image-20210603195823324.png" alt="image-20210603195823324"></p>
<p>6.将redis配置文件复制到当前目录下</p>
<p><img src="/2022/05/17/redis/image-20210603200133459.png" alt="image-20210603200133459"></p>
<p>7.redis默认不知后台启动的，需要修改配置文件<code>vim redis.conf</code> </p>
<p><img src="/2022/05/17/redis/image-20210603200452315.png"></p>
<p>8.启动redis服务</p>
<p><img src="/2022/05/17/redis/image-20210603200622845.png" alt="image-20210603200622845"></p>
<p>9.使用redis客户端连接</p>
<p><img src="/2022/05/17/redis/image-20210603200835121.png" alt="image-20210603200835121"></p>
<p>10.查看redis进程是否开启</p>
<p>![image-20210603200959309](<br>11.关闭redis服务</p>
<p><img src="/2022/05/17/redis/image-20210603201102943.png" alt="image-20210603201102943"></p>
<h5 id="测试性能"><a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h5><p><strong>redis-benchmark</strong>是一个压力测试工具！</p>
<p>官方自带的性能测试工具</p>
<p>redis-benchmark命令参数</p>
<p><img src="/2022/05/17/redis/image-20210604140602063.png" alt="image-20210604140602063"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 测试：100各并发连接 10000请求</span></span><br><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 10000</span><br></pre></td></tr></table></figure>

<h5 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h5><p>redis默认有16个数据库</p>
<p><img src="/2022/05/17/redis/image-20210604141851021.png" alt="image-20210604141851021"></p>
<p>默认使用的第0个数据库，可以使用select进行切换数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 3	<span class="comment">#切换数据库</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; dbsize	<span class="comment">#查看数据库大小</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[3]&gt; keys *	<span class="comment">#查看所有key</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">127.0.0.1:6379[3]&gt; flushdb	<span class="comment">#清空数据库</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[3]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379[3]&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[3]&gt; flushall  <span class="comment">#清空全部数据库</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Redis 是单线程</p>
</blockquote>
<p>Redis是基于内存操作，CUP不是Redis的性能瓶颈，Redis的瓶颈是根据机器的内存和网络带宽，既然可以使用单线程来实现，就是用单线程了。</p>
<p><strong>Redis为什么是单线程的还这么快</strong></p>
<ul>
<li>误区1：高性能的服务器一定是多线程的？</li>
<li>误区2：多线程（CUP上下文会切换！）一定比单线程效率高？</li>
</ul>
<p>核心：redis是将所有的数据都放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU上下文会切换：耗时的操作！！！！），对于内存系统来说，如果没有上下文切换效率就是最高的！多次读写都是在一个CPU上的，在内存情况下，这个就是最佳的方案！</p>
<h4 id="Redis五大数据类型"><a href="#Redis五大数据类型" class="headerlink" title="Redis五大数据类型"></a>Redis五大数据类型</h4><h5 id="Redis-Key"><a href="#Redis-Key" class="headerlink" title="Redis-Key"></a>Redis-Key</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name chuchu</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 18</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;mylist&quot;</span></span><br><span class="line">2) <span class="string">&quot;myhash&quot;</span></span><br><span class="line">3) <span class="string">&quot;name&quot;</span></span><br><span class="line">4) <span class="string">&quot;counter:__rand_int__&quot;</span></span><br><span class="line">5) <span class="string">&quot;age&quot;</span></span><br><span class="line">6) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; exists name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; exists age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; del name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;mylist&quot;</span></span><br><span class="line">2) <span class="string">&quot;myhash&quot;</span></span><br><span class="line">3) <span class="string">&quot;counter:__rand_int__&quot;</span></span><br><span class="line">4) <span class="string">&quot;age&quot;</span></span><br><span class="line">5) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; expire name 60	<span class="comment">#设置name的过期时间？</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; ttl anme</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> name	<span class="comment">#查看key的类型</span></span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> ange	<span class="comment">#查看key的类型</span></span><br><span class="line">none</span><br></pre></td></tr></table></figure>

<h5 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; exists key1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; append key1 hello	<span class="comment">#append命令，向字符串尾部追加字符串。如果key不存在，就会新建这个key</span></span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;v1hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; strlen key1		<span class="comment">#获取字符串长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">127.0.0.1:6379&gt; append key1 <span class="string">&quot;,world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 13</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;v1hello,world&quot;</span></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> views 0		<span class="comment">#初始浏览量为0</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; incr views		<span class="comment"># 每次加1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; incr views</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; decr views		<span class="comment">#每次减1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; decr views</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; incrby views 10	<span class="comment">#加10</span></span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">127.0.0.1:6379&gt; decrby views 5	<span class="comment">#减5</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; get</span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;get&#x27;</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line"><span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"><span class="comment">#字符串范围 range</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key1 <span class="string">&quot;hello,world&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;hello,world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getrange key1 0 3		<span class="comment">#截取字符串[0,3]</span></span><br><span class="line"><span class="string">&quot;hell&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getrange key1 0 -1		<span class="comment">#获取全部字符串</span></span><br><span class="line"><span class="string">&quot;hello,world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#替换</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key2 abcdefg</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;abcdefg&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; setrange key2 1 xx	<span class="comment">#替换 1 索引位置的bc 为 xx</span></span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;axxdefg&quot;</span></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"><span class="comment">#setex (set with expire)	#设置过期时间</span></span><br><span class="line"><span class="comment">#setnx (set if not exist)	#不存在设置（在分布式锁中会常常使用）</span></span><br><span class="line">127.0.0.1:6379&gt; setex key3 30 <span class="string">&quot;hello&quot;</span>		<span class="comment">#设置key3的值为&quot;hello&quot;，30秒后过期</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl key3</span><br><span class="line">(<span class="built_in">integer</span>) 26</span><br><span class="line">127.0.0.1:6379&gt; get key3</span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; setnx mykey <span class="string">&quot;redis&quot;</span>		<span class="comment">#mykey不存在时设置</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;key2&quot;</span></span><br><span class="line">2) <span class="string">&quot;mykey&quot;</span></span><br><span class="line">3) <span class="string">&quot;key1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ttl key3</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">127.0.0.1:6379&gt; setnx key3 <span class="string">&quot;MongDB&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SETNX mykey <span class="string">&quot;mongdb&quot;</span>		<span class="comment">#mykey存在时设置失败</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; get mykey</span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"><span class="comment">#mset #批量设置</span></span><br><span class="line"><span class="comment">#mget #批量获取</span></span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3</span><br><span class="line">1) <span class="string">&quot;v1&quot;</span></span><br><span class="line">2) <span class="string">&quot;v2&quot;</span></span><br><span class="line">3) <span class="string">&quot;v3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; msetnx k1 v1 k5 v5		<span class="comment">#msetnx 批量不存在时设置，要么一起成功，要么一起失败</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"><span class="comment"># 对象</span></span><br><span class="line"><span class="built_in">set</span> user:1 &#123;name:zhangsan,age:3&#125; <span class="comment">#设置一个user:1对象  值为json字符串来保存一个对象</span></span><br><span class="line"><span class="comment">#这里的key时巧妙的设计：  user:&#123;id&#125;:&#123;filed&#125;,如此设计</span></span><br><span class="line">127.0.0.1:6379&gt; mset user:1:name zhangsan user:1:age 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line">getset <span class="comment">#先get后set</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; getset db redis		<span class="comment">#如果不存在值，返回null,如果存在值返回db</span></span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getset db mongodb	<span class="comment">#如果存在值，获取原来的值，并设置新的值</span></span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>String类似的使用场景：value除了时字符串还可以时数组</p>
<ul>
<li>计数器</li>
<li>统计多单位的数量</li>
</ul>
<hr>
<h5 id="List-列表"><a href="#List-列表" class="headerlink" title="List (列表)"></a>List (列表)</h5><p>基本的数据类型，列表</p>
<p>在redis中可以将list用成<strong>栈、队列、阻塞队列</strong></p>
<p>所有的list命令都是<strong>L</strong>开头的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush list one		<span class="comment">#将一个值或多个值插入列表的头部（左）</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush list two</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lpush list three</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1		<span class="comment">#获取list中的值</span></span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; rpush list four		<span class="comment">#将一个值或多个值插入列表的尾部（右）</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;four&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;four&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lpop list 		<span class="comment">#移除左边的值</span></span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;four&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; rpop list		<span class="comment">#移除右边的值</span></span><br><span class="line"><span class="string">&quot;four&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">lindex <span class="comment">#获取索引对应的值</span></span><br><span class="line">127.0.0.1:6379&gt; lindex list 1		<span class="comment">#通过下标获取某一个值</span></span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lindex list 0</span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">llen <span class="comment">#获取list长度</span></span><br><span class="line">127.0.0.1:6379&gt; llen list		<span class="comment">#返回列表的长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">移除指定的值</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrem list 1 one</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lpush list three</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrem list 2 three	<span class="comment">#移除list中指定个数的value,精确匹配</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">trim 修剪：list 截断</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist <span class="string">&quot;hello1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist <span class="string">&quot;hello2&quot;</span> <span class="string">&quot;hello3&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello1&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello2&quot;</span></span><br><span class="line">4) <span class="string">&quot;hello3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ltrim mylist 1 2		<span class="comment">#通过下标截取指定的长度，这个list已经被改变了，只剩下截取的元素了</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello2&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">rpoplpush		<span class="comment">#移除列表最后一个元素，并且将它添加到另一个元素并返回</span></span><br><span class="line">127.0.0.1:6379&gt; rpush mylist <span class="string">&quot;hello&quot;</span> <span class="string">&quot;hello1&quot;</span> <span class="string">&quot;hello2&quot;</span> <span class="string">&quot;hello3&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello1&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello2&quot;</span></span><br><span class="line">4) <span class="string">&quot;hello3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; rpoplpush mylist myotherlist		<span class="comment">#移除mylist最后一个元素，并且将它添加到myotherlist中并返回</span></span><br><span class="line"><span class="string">&quot;hello3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello1&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange myotherlist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello3&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">lset  <span class="comment">#将列表指定索引处设置元素值（替换）</span></span><br><span class="line">127.0.0.1:6379&gt; lpush list value1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 0</span><br><span class="line">1) <span class="string">&quot;value1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lset list 0 item</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 0</span><br><span class="line">1) <span class="string">&quot;item&quot;</span></span><br><span class="line"><span class="comment">########################################################################################</span></span><br><span class="line">linsert <span class="comment">#在某个元素的前面或者后面插入一个值</span></span><br><span class="line">127.0.0.1:6379&gt; rpush mylist <span class="string">&quot;hello&quot;</span> <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; linsert mylist before <span class="string">&quot;world&quot;</span> <span class="string">&quot;other&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;other&quot;</span></span><br><span class="line">3) <span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; linsert mylist after <span class="string">&quot;world&quot;</span> <span class="string">&quot;new&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;other&quot;</span></span><br><span class="line">3) <span class="string">&quot;world&quot;</span></span><br><span class="line">4) <span class="string">&quot;new&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<ul>
<li>他实际是一个链表，before node after,left  ,right都可以插入值</li>
<li>如果key不存在，创建新的链表</li>
<li>如果key存在，新增内容</li>
<li>如果移除了所有值，空链表，也代表不存在</li>
<li>在两边插入或者改动值，效率最高。中间元素，相对来说效率会低一点。</li>
</ul>
<p>消息排队！消息队列 (lpush rpop )，栈（lpush,lpop）.</p>
<hr>
<h5 id="Set-集合"><a href="#Set-集合" class="headerlink" title="Set(集合)"></a>Set(集合)</h5><p>set中的值不能重复</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;world&quot;</span> <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sismember myset hello		<span class="comment">#判断某个值是不是在set中</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">127.0.0.1:6379&gt; scard myset <span class="comment">#获取set中元素的个数</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">127.0.0.1:6379&gt; srem myset <span class="string">&quot;hello&quot;</span>		<span class="comment">#移除某个元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers myset	</span><br><span class="line">1) <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="built_in">set</span> 无序不重复集合</span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">3) <span class="string">&quot;chuchu2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset		<span class="comment">#随机抽选出一个元素</span></span><br><span class="line"><span class="string">&quot;chuchu2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset 2		<span class="comment">#随机抽选出两个元素</span></span><br><span class="line"><span class="string">&quot;chuchu2&quot;</span> <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;chuchu&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;chuchu&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;chuchu2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;chuchu&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;chuchu&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;chuchu2&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">删除指定的key,随机删除key</span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">3) <span class="string">&quot;chuchu2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; spop myset		<span class="comment">#随机删除集合中的一些元素</span></span><br><span class="line"><span class="string">&quot;chuchu2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;chuchu&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">将一个指定的值，移动到另一个集合中</span><br><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;hello&quot;</span> <span class="string">&quot;world&quot;</span> <span class="string">&quot;nihao&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; smove myset myset2 hello	<span class="comment">#将myset中的hello移动到myset2中</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;world&quot;</span></span><br><span class="line">2) <span class="string">&quot;nihao&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">微博，b站，共同关注（交集）</span><br><span class="line">127.0.0.1:6379&gt; sadd key1 a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; sadd key2 c d </span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; sdiff key1 key2		<span class="comment">#查看不同的</span></span><br><span class="line">1) <span class="string">&quot;a&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinter key1 key2		<span class="comment">#查看相同的（交集）</span></span><br><span class="line">1) <span class="string">&quot;c&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sunion key1 key2		<span class="comment">#并集</span></span><br><span class="line">1) <span class="string">&quot;d&quot;</span></span><br><span class="line">2) <span class="string">&quot;a&quot;</span></span><br><span class="line">3) <span class="string">&quot;b&quot;</span></span><br><span class="line">4) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>微博，A用户将所有关注的人放在一个set集合中。将它的粉丝也放在一个集合中。</p>
<h5 id="Hash-哈希"><a href="#Hash-哈希" class="headerlink" title="Hash(哈希)"></a>Hash(哈希)</h5><hr>
<p>Map集合，key-map!这时候这个值是一个map集合！本质与String类型没有太大区别，还是一个简单的key-value.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset myhash field1 chuchu		<span class="comment">#往map里添加元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hget myhash field1				<span class="comment">#获取元素</span></span><br><span class="line"><span class="string">&quot;chuchu&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hmset myhash field1 hello field2 world	<span class="comment">#一次添加多个</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmget myhash field1 field2		<span class="comment">#一次获取多个</span></span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash		<span class="comment">#获取全部</span></span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;field2&quot;</span></span><br><span class="line">4) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">127.0.0.1:6379&gt; hdel myhash field2		<span class="comment">#删除指定的值</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash </span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">获取长度</span><br><span class="line">hlen</span><br><span class="line">127.0.0.1:6379&gt; hmset myhash field3 hello field4 redis</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hlen myhash		<span class="comment">#获取字段数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash</span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;field3&quot;</span></span><br><span class="line">4) <span class="string">&quot;hello&quot;</span></span><br><span class="line">5) <span class="string">&quot;field4&quot;</span></span><br><span class="line">6) <span class="string">&quot;redis&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hget myhash field3</span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">判断某个值是否存在</span><br><span class="line">127.0.0.1:6379&gt; hexists myhash field	<span class="comment">#判断field是否存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; hexists myhash field1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">#只获得所有的字段</span></span><br><span class="line"><span class="comment">#只获得所有的值</span></span><br><span class="line">127.0.0.1:6379&gt; hkeys myhash		<span class="comment">#获取所有的字段key</span></span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;field3&quot;</span></span><br><span class="line">3) <span class="string">&quot;field4&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hvals myhash		<span class="comment">#获取所有的值value</span></span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">#incr decr</span></span><br><span class="line">127.0.0.1:6379&gt; hset myhash field 6</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hincrby myhash field 2		<span class="comment">#增加2</span></span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash field4 9		<span class="comment">#不存在时设置自动为9，如果已经存在就不成功</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash field7 2		<span class="comment">#不存在时设置自动为9，如果不存在就成功</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Zset-有序集合"><a href="#Zset-有序集合" class="headerlink" title="Zset(有序集合)"></a>Zset(有序集合)</h5><p>在set的基础上，增加了一个值，set k1 v1 &#x3D;&gt; zset k1 score v1</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd myset 1 one</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 2 two 3 three</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; zrange myset 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">127.0.0.1:6379&gt; zadd salary 2500 zhangsan 5000 wangsi 500 liwu</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore salary -inf +inf	<span class="comment">#从最小值到最大值排序</span></span><br><span class="line">1) <span class="string">&quot;liwu&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">3) <span class="string">&quot;wangsi&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrevrange salary 0 -1		<span class="comment">#从最大值到最小值排序</span></span><br><span class="line">1) <span class="string">&quot;wangsi&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore salary -inf +inf withscores	<span class="comment">#加上key</span></span><br><span class="line">1) <span class="string">&quot;liwu&quot;</span></span><br><span class="line">2) <span class="string">&quot;500&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">4) <span class="string">&quot;2500&quot;</span></span><br><span class="line">5) <span class="string">&quot;wangsi&quot;</span></span><br><span class="line">6) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">移除rem中的元素</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) <span class="string">&quot;liwu&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">3) <span class="string">&quot;wangsi&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrem salary liwu		<span class="comment">#移除指定集合中的元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;wangsi&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zcard salary		<span class="comment">#获取集合中的个数</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 1 hello 2 world 3 chuchu 4 dedi		</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; zcount myset 1 3			<span class="comment">#获取指定区间内的个数</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="headerlink" title="三种特殊数据类型"></a>三种特殊数据类型</h4><h5 id="geospatial地理位置"><a href="#geospatial地理位置" class="headerlink" title="geospatial地理位置"></a>geospatial地理位置</h5><hr>
<blockquote>
<p>geoadd</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#geoadd 添加地理位置</span></span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 116.40 39.90 beijing 	<span class="comment">#添加城市数据</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.47 31.23 shanghai 106.50 29.53 chongqing 114.05 22.52 shenzhen</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 120.16 30.24 hangzhou</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 108.96 34.26 xian</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>geopos</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos china:city beijing chongqing		<span class="comment">#获取指定城市的经纬度</span></span><br><span class="line">1) 1) <span class="string">&quot;116.39999896287918091&quot;</span></span><br><span class="line">   2) <span class="string">&quot;39.90000009167092543&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;106.49999767541885376&quot;</span></span><br><span class="line">   2) <span class="string">&quot;29.52999957900659211&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>geodist</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist china:city chongqing xian	<span class="comment">#获取重庆 西安之间的距离</span></span><br><span class="line"><span class="string">&quot;575046.9885&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; geodist china:city chongqing xian km	<span class="comment">#获取重庆 西安之间的距离 km</span></span><br><span class="line"><span class="string">&quot;575.0470&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>我附近的人？（获得所有附近的人的地址，定位）通过半径来查询</p>
<p>georadius:以给定的经纬度为中心，查询某一半径内的元素</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km			<span class="comment">#以经纬度110 30 为中心寻找方圆1000km的元素</span></span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;xian&quot;</span></span><br><span class="line">3) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">4) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 500 km</span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;xian&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 500 km withcoord		<span class="comment">#把经纬度一块查出来</span></span><br><span class="line">1) 1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;106.49999767541885376&quot;</span></span><br><span class="line">      2) <span class="string">&quot;29.52999957900659211&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;xian&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;108.96000176668167114&quot;</span></span><br><span class="line">      2) <span class="string">&quot;34.25999964418929977&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 500 km withcoord count 1		<span class="comment">#限制查询多少个</span></span><br><span class="line">1) 1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;106.49999767541885376&quot;</span></span><br><span class="line">      2) <span class="string">&quot;29.52999957900659211&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>georadiusbymember :以给定的元素为中心，寻找</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadiusbymember china:city shanghai 300 km	<span class="comment">#找出以上海为中心，300km内的城市</span></span><br><span class="line">1) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">2) <span class="string">&quot;shanghai&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>geo 底层的实验原理其实就是zset，我们可以使用zset命令来操作geo!</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange china:city 0 -1		<span class="comment">#查看地图中全部的元素</span></span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;xian&quot;</span></span><br><span class="line">3) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">4) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">5) <span class="string">&quot;shanghai&quot;</span></span><br><span class="line">6) <span class="string">&quot;beijing&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrem china:city beijing		<span class="comment">#移除特定的元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange china:city 0 -1	</span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;xian&quot;</span></span><br><span class="line">3) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">4) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">5) <span class="string">&quot;shanghai&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h5><blockquote>
<p>什么是基数？</p>
</blockquote>
<p>A{1,3,5,7,8,7}</p>
<p>B{1,3,5,7,8}</p>
<p>基数（不重复的元素） &#x3D; 5，可以接受误差。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfadd myset a b c d e f g h i j		<span class="comment">#创建第一组元素myset</span></span><br><span class="line">(<span class="built_in">integer</span>) 1	</span><br><span class="line">127.0.0.1:6379&gt; pfcount myset						<span class="comment">#统计myset元素的基数数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">127.0.0.1:6379&gt; pfadd myset2 i j k z x c v b n m		<span class="comment">#创建第二组元素myset2</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount myset2</span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">127.0.0.1:6379&gt; pfmerge mykey3 myset myset2			<span class="comment">#合并两个元素 并集</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount mykey3</span><br><span class="line">(<span class="built_in">integer</span>) 16</span><br></pre></td></tr></table></figure>

<p>如果允许容错，可以使用hyperloglog;如果不允许容错，使用set</p>
<hr>
<h5 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h5><blockquote>
<p>位存储</p>
</blockquote>
<p>统计疫情感染人数：0 1 0 1</p>
<p>统计用户信息，活跃，不活跃！登录，未登录！两个状态的都可以使用bitmaps</p>
<p>Bitmaps位图，数据结构！都是操作二进制位来进行记录，就只有0和1两个状态！</p>
<p>365天&#x3D; 365 bit    1字节&#x3D; 8 bit  46个字节左右</p>
<p>使用bitmap记录周一到周日的打卡！</p>
<p>周一：1  周二 ：0  周三 0  周四：1 ………</p>
<p><img src="/2022/05/17/redis/image-20210604222909632.png" alt="image-20210604222909632"></p>
<p>查看某一个是否有打卡：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; getbit sign 3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 6</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>统计操作，统计打卡的天数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bitcount sign 0 3  <span class="comment">#查看0-3天的打卡记录（可以忽略最后两个参数）</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>



<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>要么同时成功，要么同时失败，原子性！</p>
<p><strong>redis单条命令是保证原子性的，但redis的事务是不保证原子性的！</strong></p>
<p>redis事务本质：一组命令的集合！一个事务中的所有米杠零都会被序列化，在事务执行国策和观念中，会按照顺序执行！</p>
<p>一次性、顺序性、排他性！</p>
<p><strong>redis没有隔离级别的概念</strong></p>
<p>所有的命令在食物中，并没有直接被执行！只有发起执行名命令的之后才会执行！Exec</p>
<p>redis的事务：</p>
<ul>
<li>开启事务（）</li>
<li>命令入队（）</li>
<li>执行事务（）</li>
</ul>
<blockquote>
<p>正常执行事务：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi			<span class="comment">#开启事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k1 v1	<span class="comment">#命令入队</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">exec</span>		<span class="comment">#执行事务</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">&quot;v2&quot;</span></span><br><span class="line">4) OK</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>放弃事务</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi		<span class="comment">#开启事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k4 v4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; discard		<span class="comment">#放弃事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k4		<span class="comment">#事务队列中的命令都不会被执行！</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译型异常（代码有问题！命令有错！），事务中所有的命令都不会被执行!</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED	</span><br><span class="line">127.0.0.1:6379(TX)&gt; getset k3			<span class="comment">#错误的命令</span></span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;getset&#x27;</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k4 v4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k5 v5</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">exec</span>		<span class="comment">#执行事务报错</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">								<span class="comment">#所有的命令都没有执行</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>运行时异常（1&#x2F;0)，如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行的，错误命令抛出异常。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 <span class="string">&quot;v1&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; incr k1		<span class="comment">#执行的时候会失败</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">exec</span></span><br><span class="line">1) (error) ERR value is not an <span class="built_in">integer</span> or out of range		<span class="comment">#虽然第一条命令报错了，但是依旧执行成功了</span></span><br><span class="line">2) OK</span><br><span class="line">3) OK</span><br><span class="line">4) <span class="string">&quot;v3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">&quot;v2&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>监控！Watch</p>
</blockquote>
<p><strong>悲观锁：</strong></p>
<ul>
<li>很悲观，什么时候都会出问题，无论什么时候都会加锁</li>
</ul>
<p><strong>乐观锁</strong></p>
<ul>
<li>很乐观，认为什么时候都不会出问题，所以不会上锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据，version！</li>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
<blockquote>
<p> Redis的监视测试</p>
</blockquote>
<p>正常执行成功！</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money		<span class="comment">#监视money对象</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi			<span class="comment">#事务正常结束，数据期间没有发生变动，这个时候就正常执行成功</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>

<p>测试多线程修改值，使用watch可以当作redis的乐观锁操作。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br><span class="line">127.0.0.1:6379&gt; watch money			<span class="comment">#监视 money</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; decrby money 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; <span class="built_in">exec</span>			<span class="comment">#执行之前 ，另一个线程，修改了money,这个时候，就会导致事务执行失败。</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h4><p>我们要使用java来操作redis</p>
<blockquote>
<p>jedis是redis官方推荐的Java连接开发工具！使用Java操作redis的中间件</p>
</blockquote>
<p>1、导入对应的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  导入jedis包  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   fastjson     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编码测试：</p>
<ul>
<li>连接数据库</li>
<li>操作命令</li>
<li>断开连接</li>
</ul>
<hr>
<h4 id="Springboot整合"><a href="#Springboot整合" class="headerlink" title="Springboot整合"></a>Springboot整合</h4><p>Springboot操作数据：spring-data  jpa  jdbc  mongodb  redis</p>
<p>springdata也是和springboot齐名的项目</p>
<p>说明：在springboot2.x后，原来使用的jedis被替换为了lettuce</p>
<p>jedis:采用直连，多个线程操作的话，是不安全的，如果想要避免，使用jedis pool连接池。更像BIO模式</p>
<p>lettuce:采用netty，实例可以在多个线程中共享，不存在不安全的情况，减少线程数量。更像NIO模式。</p>
<blockquote>
<p>整合测试</p>
</blockquote>
<hr>
<h4 id="Redis-conf详解"><a href="#Redis-conf详解" class="headerlink" title="Redis.conf详解"></a>Redis.conf详解</h4><hr>
<h4 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h4><p>redis是内存数据库，如果不保存到磁盘那么一旦服务器进行退出，服务器中的数据库状态也会消失，所以redis提供了持久化的功能！</p>
<h5 id="rdb（redis-database"><a href="#rdb（redis-database" class="headerlink" title="rdb（redis database)"></a>rdb（redis database)</h5><blockquote>
<p>什么是rdb</p>
<p>在rdb中是做备份的。</p>
</blockquote>
<p><img src="/2022/05/17/redis/image-20210605220814251.png" alt="image-20210605220814251"></p>
<p>在指定的时间间隔内将内存中的数据集体快照写入磁盘，也就是行话说的Snapshot快照，他恢复时是将快照文件直接读到内存里</p>
<p>Redis会单独创建（fork）一子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。这就确保了极高的性能。如果需要进行大规模的数据回复，且对于数据恢复的完整性不是非常铭感，那么RDB方式要比AOF方式更加的搞笑。RDB的缺点是最后一个持久化后的数据可能丢失。我们默认的就是RDB，一般情况下不需要修改这个配置。</p>
<p><strong>rdb保存的文件就是dump.rdb</strong>，都是再配置文件的快照中配置的。</p>
<p><img src="/2022/05/17/redis/image-20210605215959106.png" alt="image-20210605215959106"></p>
<p><img src="/2022/05/17/redis/image-20210605220113199.png" alt="image-20210605220113199"></p>
<blockquote>
<p>触发机制</p>
</blockquote>
<p>1.save的规则满足的情况下，会自动触发rdb规则</p>
<p>2.执行flushall命令，也会触发rdb规则</p>
<p>3.退出redis,也会产生rdb文件</p>
<p>备份就自动生成一个dump.rdb文件</p>
<blockquote>
<p>如何恢复rdb文件</p>
</blockquote>
<p>1.将rdb文件放在redis启动目录下，redis启动的时候就会自动检测dump.rdb文件，恢复其中的数据！</p>
<p><img src="/2022/05/17/redis/image-20210605220725190.png" alt="image-20210605220725190"></p>
<p>优点：</p>
<p>1.适合大规模的数据恢复</p>
<p>2.对数据的完整性不高！</p>
<p>缺点：</p>
<p>1.需要一定的时间间隔进行操作。如果redis意外宕机了，这个最后一个修改的数据就没有了</p>
<p>2.frok进程的时候，会占用一定的内存。</p>
<h5 id="AOF（Append-Only-File）"><a href="#AOF（Append-Only-File）" class="headerlink" title="AOF（Append Only File）"></a>AOF（Append Only File）</h5><p>将我们的所有命令都记录下来，history,恢复的时候就把这个文件都执行一遍。</p>
<blockquote>
<p>是什么</p>
</blockquote>
<p><img src="/2022/05/17/redis/image-20210605221159230.png" alt="image-20210605221159230"></p>
<p>以日志的形式来记录每个写操作，将Redis执行过的所有执行记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话根据日志文件的内容将写质量从前到后执行一次完成数据的恢复工作。</p>
<p><strong>AOF保存的是appendonly.aof文件</strong></p>
<blockquote>
<p>append</p>
</blockquote>
<p><img src="/2022/05/17/redis/image-20210605221453938.png" alt="image-20210605221453938"></p>
<p>默认是不开启的，首要手动进行配置。只需要将图片中的no改成yes即可。</p>
<p>重启，redis就可以生效了</p>
<p>如果这个aof文件有错误，这时候，redis是启动不起来的，我们需要修复这个aof文件。</p>
<p>redis给提供了一个工具<strong>redis-check-aof –fix</strong></p>
<p><img src="/2022/05/17/redis/image-20210605221951633.png" alt="image-20210605221951633"></p>
<p>如果文件正常，重启就可以直接恢复</p>
<p><img src="/2022/05/17/redis/image-20210605222035669.png" alt="image-20210605222035669"></p>
<blockquote>
<p>重写的说明</p>
</blockquote>
<p>aof默认就是文件的无限追加，文件会越来越大</p>
<p><img src="/2022/05/17/redis/image-20210605222459699.png" alt="image-20210605222459699"></p>
<p>如果文件大于64mb,就会fork一个新进程，来存储。</p>
<blockquote>
<p>优点和缺点</p>
</blockquote>
<p>优点：</p>
<p><img src="/2022/05/17/redis/image-20210605222146491.png" alt="image-20210605222146491"></p>
<ul>
<li>每一次修改都同步，文件的完成行会更好。</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率最高。</li>
</ul>
<p>缺点</p>
<ul>
<li>相对于数据文件来说，aof远远大于rdb,修复的速度比rdb慢</li>
<li>aof运行效率要比rdb慢，所以redis默认是rdb持久化</li>
</ul>
<p><img src="/2022/05/17/redis/image-20210605222653878.png" alt="image-20210605222653878"></p>
<p><img src="/2022/05/17/redis/image-20210605222710992.png" alt="image-20210605222710992"></p>
<hr>
<h4 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h4><p>Redis发布订阅（pub&#x2F;sub）是一种消息通信模式：发送者（pub）发送消息，订阅者(sub)接收消息。微信、微博、关注系统</p>
<p>Redis客户端可以订阅任意数量的频道。</p>
<p>订阅&#x2F;发布消息图：</p>
<p>第一个：消息发送者，第二个：i难道  第三个：消息订阅者</p>
<p><img src="/2022/05/17/redis/image-20210605222937453.png" alt="image-20210605222937453"></p>
<p>下图展示了频道channel1,以及订阅这个批到的三个客户端    cliend2  client5  client1之间的关系：</p>
<p><img src="/2022/05/17/redis/image-20210605223110336.png" alt="image-20210605223110336"></p>
<p>当有新消息通过PUBLISH命令发送给频道channel1是，这个消息就会被发送给订阅他的三个客户端：</p>
<p><img src="/2022/05/17/redis/image-20210605223151668.png" alt="image-20210605223151668"></p>
<blockquote>
<p>命令</p>
</blockquote>
<p><img src="/2022/05/17/redis/image-20210605223221923.png" alt="image-20210605223221923"></p>
<blockquote>
<p>测试</p>
</blockquote>
<p><img src="/2022/05/17/redis/image-20210605223513325.png" alt="image-20210605223513325"></p>
<p><img src="/2022/05/17/redis/image-20210605223555029.png" alt="image-20210605223555029"></p>
<p>使用场景：</p>
<ul>
<li>实时消息系统</li>
<li>实时聊天（频道当作聊天室，将信息回显给所有人）</li>
<li>订阅，关注系统</li>
</ul>
<p>稍微复杂的场景就会使用消息中间件做。</p>
<hr>
<h4 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h4><p><img src="/2022/05/17/redis/image-20210605224004576.png" alt="image-20210605224004576"></p>
<p><img src="/2022/05/17/redis/image-20210605224158394.png" alt="image-20210605224158394"></p>
<p><img src="/2022/05/17/redis/image-20210605223945161.png" alt="image-20210605223945161"></p>
<h5 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@wang bin]<span class="comment"># cd /usr/local/bin/</span></span><br><span class="line">[root@wang bin]<span class="comment"># redis-server myconfig/redis.conf </span></span><br><span class="line">[root@wang bin]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line">127.0.0.1:6379&gt; info replication			<span class="comment">#查看当前库的信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master				<span class="comment">#角色  master</span></span><br><span class="line">connected_slaves:0		<span class="comment">#没有从机</span></span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:2854ce507ff1f9aff323997061d3b23625d6630f</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>

<p>复制三个配置文件，然后修改对应的信息：</p>
<ul>
<li>端口</li>
<li>pid名字</li>
<li>log文件名字</li>
<li>dump.rdb名字</li>
</ul>
<p>修改完毕之后启动3个服务，可以通过进程查看。</p>
<p><img src="/2022/05/17/redis/image-20210605225646549.png" alt="image-20210605225646549"></p>
<h5 id="一主二从"><a href="#一主二从" class="headerlink" title="一主二从"></a>一主二从</h5><p><strong>默认情况下，每台Redis服务器都是主节点；</strong>一般情况下配置从机就好</p>
<p>认老大！一主（79）二从（80，81）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379		<span class="comment">#配置为从机</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave			<span class="comment">#当前角色</span></span><br><span class="line">master_host:127.0.0.1		<span class="comment">#主机的信息</span></span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:2</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:0</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">replica_announced:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:1c57c3653aeea15421b2823d167bafeb33328320</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"><span class="comment">#主机信息</span></span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=224,lag=0</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=224,lag=0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:1c57c3653aeea15421b2823d167bafeb33328320</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:224</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:224</span><br></pre></td></tr></table></figure>

<p>真实的配置应该在配置文件中进行配置。</p>
<blockquote>
<p>细节</p>
</blockquote>
<p>主机可以写，从机布恩那个写只能读。主机的所有数据，都会被从机自动保存。</p>
<p><img src="/2022/05/17/redis/image-20210606123842636.png" alt="image-20210606123842636"></p>
<p><img src="/2022/05/17/redis/image-20210606124414757.png" alt="image-20210606124414757"></p>
<h4 id="哨兵模式（自动选举老大的模式）"><a href="#哨兵模式（自动选举老大的模式）" class="headerlink" title="哨兵模式（自动选举老大的模式）"></a>哨兵模式（自动选举老大的模式）</h4><hr>
<p><img src="/2022/05/17/redis/image-20210606124522477.png" alt="image-20210606124522477"></p>
<p><img src="/2022/05/17/redis/image-20210606124552896.png" alt="image-20210606124552896"></p>
<p><img src="/2022/05/17/redis/Cimage-20210606124640481.png" alt="image-20210606124640481"></p>
<p><img src="/2022/05/17/redis/image-20210606124712184.png" alt="image-20210606124712184"></p>
<p><img src="/2022/05/17/redis/image-20210606125014448.png" alt="image-20210606125014448"></p>
<p><img src="/2022/05/17/redis/image-20210606125528056.png" alt="image-20210606125528056"></p>
<p><img src="/2022/05/17/redis/image-20210606125421955.png" alt="image-20210606125421955"></p>
<p><img src="/2022/05/17/redis/image-20210606125552003.png" alt="image-20210606125552003"></p>
<p><img src="/2022/05/17/redis/image-20210606125658591.png" alt="image-20210606125658591"></p>
<p><img src="/2022/05/17/redis/image-20210606125811111.png" alt="image-20210606125811111"></p>
<hr>
<h4 id="Redis缓存穿透和雪崩"><a href="#Redis缓存穿透和雪崩" class="headerlink" title="Redis缓存穿透和雪崩"></a>Redis缓存穿透和雪崩</h4><h5 id="缓存穿透（查不到）"><a href="#缓存穿透（查不到）" class="headerlink" title="缓存穿透（查不到）"></a>缓存穿透（查不到）</h5><p><img src="/2022/05/17/redis/image-20210606130057642.png" alt="image-20210606130057642"></p>
<p><img src="/2022/05/17/redis/image-20210606130334389.png" alt="image-20210606130334389"></p>
<p><img src="/2022/05/17/redis/image-20210606130406045.png"></p>
<h5 id="缓存击穿（量太大，缓存过期）"><a href="#缓存击穿（量太大，缓存过期）" class="headerlink" title="缓存击穿（量太大，缓存过期）"></a>缓存击穿（量太大，缓存过期）</h5><p><img src="/2022/05/17/redis/image-20210606130504240.png" alt="image-20210606130504240"></p>
<p><img src="/2022/05/17/redis/Cimage-20210606130645085.png" alt="image-20210606130645085"></p>
<h5 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h5><p><img src="/2022/05/17/redis/image-20210606130812505.png" alt="image-20210606130812505"></p>
<p><img src="/2022/05/17/redis/image-20210606131018633.png" alt="image-20210606131018633"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/redis/">redis</a></div><div class="post_share"><div class="social-share" data-image="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/17/JUC/"><img class="prev-cover" src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JUC</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/17/linux/"><img class="next-cover" src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">linux</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">盖哥横扫千军</div><div class="author-info__description">啷里格啷</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nosql%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Nosql概述</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8Nosql"><span class="toc-number">1.1.</span> <span class="toc-text">为什么要用Nosql</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFNoSQL"><span class="toc-number">1.2.</span> <span class="toc-text">什么是NoSQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E6%BC%94%E8%BF%9B%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">阿里巴巴演进分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NoSQL%E7%9A%84%E5%9B%9B%E5%A4%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">NoSQL的四大分类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">Redis入门</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#windows%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">windows安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#linux%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">linux安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%80%A7%E8%83%BD"><span class="toc-number">2.4.</span> <span class="toc-text">测试性能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.5.</span> <span class="toc-text">基础知识</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">Redis五大数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis-Key"><span class="toc-number">3.1.</span> <span class="toc-text">Redis-Key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">String（字符串）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#List-%E5%88%97%E8%A1%A8"><span class="toc-number">3.3.</span> <span class="toc-text">List (列表)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Set-%E9%9B%86%E5%90%88"><span class="toc-number">3.4.</span> <span class="toc-text">Set(集合)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hash-%E5%93%88%E5%B8%8C"><span class="toc-number">3.5.</span> <span class="toc-text">Hash(哈希)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Zset-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-number">3.6.</span> <span class="toc-text">Zset(有序集合)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">三种特殊数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#geospatial%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">geospatial地理位置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hyperloglog"><span class="toc-number">4.2.</span> <span class="toc-text">Hyperloglog</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Bitmaps"><span class="toc-number">4.3.</span> <span class="toc-text">Bitmaps</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">5.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Jedis"><span class="toc-number">6.</span> <span class="toc-text">Jedis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Springboot%E6%95%B4%E5%90%88"><span class="toc-number">7.</span> <span class="toc-text">Springboot整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-conf%E8%AF%A6%E8%A7%A3"><span class="toc-number">8.</span> <span class="toc-text">Redis.conf详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">9.</span> <span class="toc-text">Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rdb%EF%BC%88redis-database"><span class="toc-number">9.1.</span> <span class="toc-text">rdb（redis database)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AOF%EF%BC%88Append-Only-File%EF%BC%89"><span class="toc-number">9.2.</span> <span class="toc-text">AOF（Append Only File）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-number">10.</span> <span class="toc-text">Redis发布订阅</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">11.</span> <span class="toc-text">Redis主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">11.1.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%8E"><span class="toc-number">11.2.</span> <span class="toc-text">一主二从</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%EF%BC%88%E8%87%AA%E5%8A%A8%E9%80%89%E4%B8%BE%E8%80%81%E5%A4%A7%E7%9A%84%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">12.</span> <span class="toc-text">哨兵模式（自动选举老大的模式）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9"><span class="toc-number">13.</span> <span class="toc-text">Redis缓存穿透和雪崩</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%EF%BC%88%E6%9F%A5%E4%B8%8D%E5%88%B0%EF%BC%89"><span class="toc-number">13.1.</span> <span class="toc-text">缓存穿透（查不到）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%EF%BC%88%E9%87%8F%E5%A4%AA%E5%A4%A7%EF%BC%8C%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F%EF%BC%89"><span class="toc-number">13.2.</span> <span class="toc-text">缓存击穿（量太大，缓存过期）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">13.3.</span> <span class="toc-text">缓存雪崩</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/17/alogrithm/" title="alogrithm"><img src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="alogrithm"/></a><div class="content"><a class="title" href="/2022/05/17/alogrithm/" title="alogrithm">alogrithm</a><time datetime="2022-05-17T02:07:08.000Z" title="发表于 2022-05-17 10:07:08">2022-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/17/spring/" title="spring"><img src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="spring"/></a><div class="content"><a class="title" href="/2022/05/17/spring/" title="spring">spring</a><time datetime="2022-05-17T02:06:42.000Z" title="发表于 2022-05-17 10:06:42">2022-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/17/Tomcat/" title="Tomcat"><img src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Tomcat"/></a><div class="content"><a class="title" href="/2022/05/17/Tomcat/" title="Tomcat">Tomcat</a><time datetime="2022-05-17T02:06:21.000Z" title="发表于 2022-05-17 10:06:21">2022-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/17/JUC/" title="JUC"><img src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC"/></a><div class="content"><a class="title" href="/2022/05/17/JUC/" title="JUC">JUC</a><time datetime="2022-05-17T02:06:21.000Z" title="发表于 2022-05-17 10:06:21">2022-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/17/redis/" title="redis"><img src="/img/%E9%A3%8E%E8%8A%B1%E9%9B%AA%E6%9C%881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="redis"/></a><div class="content"><a class="title" href="/2022/05/17/redis/" title="redis">redis</a><time datetime="2022-05-17T02:06:21.000Z" title="发表于 2022-05-17 10:06:21">2022-05-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By 盖哥横扫千军</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用双线部署，默认线路托管于Vercel"><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用双线部署，联通线路托管于Coding"><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>